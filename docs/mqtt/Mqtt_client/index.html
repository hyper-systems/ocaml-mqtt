<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mqtt_client (mqtt.Mqtt_client)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">mqtt</a> &#x00BB; Mqtt_client</nav><header class="odoc-preamble"><h1>Module <code><span>Mqtt_client</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Represents an MQTT client.</p><p>To create a new client use <a href="#val-connect"><code>Mqtt_client.connect</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-credentials"><a href="#type-credentials" class="anchor"></a><code><span><span class="keyword">type</span> credentials</span><span> = </span></code><ol><li id="type-credentials.Credentials" class="def variant constructor anchored"><a href="#type-credentials.Credentials" class="anchor"></a><code><span>| </span><span><span class="constructor">Credentials</span> <span class="keyword">of</span> string * string</span></code></li><li id="type-credentials.Username" class="def variant constructor anchored"><a href="#type-credentials.Username" class="anchor"></a><code><span>| </span><span><span class="constructor">Username</span> <span class="keyword">of</span> string</span></code></li></ol></div><div class="spec-doc"><p>Client authentication credentials.</p><p>MQTT supports two authentication methods: username with password, or username only.</p><p>The credentials will be sent in plain text, unless TLS is used. See <a href="#val-connect" title="Mqtt_client.connect">connection options</a> for more information.</p></div></div><p>Client error &amp; exceptions</p><p>Defines the exceptions raised by the client</p><div class="odoc-spec"><div class="spec exception anchored" id="exception-Connection_error"><a href="#exception-Connection_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Connection_error</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-qos"><a href="#type-qos" class="anchor"></a><code><span><span class="keyword">type</span> qos</span><span> = </span></code><ol><li id="type-qos.Atmost_once" class="def variant constructor anchored"><a href="#type-qos.Atmost_once" class="anchor"></a><code><span>| </span><span><span class="constructor">Atmost_once</span></span></code></li><li id="type-qos.Atleast_once" class="def variant constructor anchored"><a href="#type-qos.Atleast_once" class="anchor"></a><code><span>| </span><span><span class="constructor">Atleast_once</span></span></code></li><li id="type-qos.Exactly_once" class="def variant constructor anchored"><a href="#type-qos.Exactly_once" class="anchor"></a><code><span>| </span><span><span class="constructor">Exactly_once</span></span></code></li></ol></div><div class="spec-doc"><p>Quality of Service level.</p><p>Defines the guarantee of delivery for messages.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : 
  <span><span class="optlabel">?id</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?tls_ca</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?credentials</span>:<a href="#type-credentials">credentials</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?will</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?clean_session</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?keep_alive</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?on_message</span>:<span>(<span><span class="label">topic</span>:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?on_disconnect</span>:<span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?on_error</span>:<span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>exn <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Connects to the MQTT broker.</p><p>Multiple hosts can be provided in case the broker supports failover. The client will attempt to connect to each one of hosts sequentially until one of them is successful.</p><p><code>on_error</code> can be provided to handle errors during client's execution. By default all internal exceptions will be raised with <code>Lwt.fail</code>.</p><p><i>Note:</i> Reconnection logic is not implemented currently.</p><pre class="language-ocaml"><code>let broker_hosts = [ (&quot;host-1&quot;, &quot;host-2&quot;) ] in

let on_message ~topic payload =
  Lwt.printlf &quot;topic=%S payload=%S&quot; topic payload
in

Mqtt_client.connect ~id:&quot;my-client&quot; ~port:1883 ~on_message broker_hosts
|&gt; Lwt_main.run</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><code><span><span class="keyword">val</span> disconnect : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Disconnects the client from the MQTT broker.</p><pre class="language-ocaml"><code>let%lwt () = Mqtt_client.disconnect client</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-publish"><a href="#val-publish" class="anchor"></a><code><span><span class="keyword">val</span> publish : 
  <span><span class="optlabel">?dup</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?qos</span>:<a href="#type-qos">qos</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retain</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">topic</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Publish a message with payload to a given topic.</p><pre class="language-ocaml"><code>let payload = &quot;Hello world&quot;;
let%lwt () = Mqtt_client.publish(~topic=&quot;news&quot;, payload, client);</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-subscribe"><a href="#val-subscribe" class="anchor"></a><code><span><span class="keyword">val</span> subscribe : <span><span><span>(string * <a href="#type-qos">qos</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Subscribes the client to a non-empty list of topics.</p><pre class="language-ocaml"><code>let topics =
  [
    (&quot;news/fashion&quot;, Mqtt_client.Atmost_once);
    (&quot;news/science&quot;, Mqtt_client.Atleast_once);
  ]
in
Mqtt_client.subscribe topics client</code></pre></div></div></div></body></html>
